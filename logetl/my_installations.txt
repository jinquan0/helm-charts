## --------------------------------- demo with ceph pvc ---------------------------------
helm install logetl-test-jinquan-0 . \
  --namespace infra --create-namespace \
  --set replicaCount=1 \
  --set PodCephPvc.enabled=true \
  --set PodCephPvc.Capacity=30Mi \
  --set PodCephPvc.StorageClass="csi-rbd-sc" \
  --set-file etl.StreamFilter="./etl/filters/common.conf"

## --------- ingress nginx controller demo with MAXMIND GeoLite2-City.mmdb  ---------
helm install logetl-test-jinquan-0 . \
  --namespace infra --create-namespace \
  --set image.repository="docker-hub.supor.com/infra/logstash" \
  --set image.tag="7.17.3-geoip" \
  --set replicaCount=1 \
  --set etl.Kafka.Topic=prod-bd-xcxsc-ingngx \
  --set etl.Kafka.ConsumerGroup=prod-bd-xcxsc \
  --set-file etl.StreamFilter="./etl/filters/ingngx-geocity.conf" \
  --set etl.StreamOutput.debugconsole.enabled=true

## ------------------------------------- AWS xcxsc -------------------------------------
helm install logetl-prod-bd-xcxsc-admin . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set etl.Name=logetl-prod-bd-xcxsc-admin \
  --set etl.Kafka.Topic=prod-bd-xcxsc-admin \
  --set etl.Kafka.ConsumerGroup=prod-bd-xcxsc \
  --set etl.ElasticSearch.Index=prod-bd-xcxsc-admin-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/aws-xcxsc-app.conf"

helm install logetl-prod-bd-xcxsc-api . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set etl.Name=logetl-prod-bd-xcxsc-api \
  --set etl.Kafka.Topic=prod-bd-xcxsc-api \
  --set etl.Kafka.ConsumerGroup=prod-bd-xcxsc \
  --set etl.ElasticSearch.Index=prod-bd-xcxsc-api-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/aws-xcxsc-app.conf"

helm install logetl-prod-bd-xcxsc-messenger . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set etl.Name=logetl-prod-bd-xcxsc-messenger \
  --set etl.Kafka.Topic=prod-bd-xcxsc-messenger \
  --set etl.Kafka.ConsumerGroup=prod-bd-xcxsc \
  --set etl.ElasticSearch.Index=prod-bd-xcxsc-messenger-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/aws-xcxsc-app.conf"

helm install logetl-prod-bd-xcxsc-cronjob . --namespace infra --create-namespace \
  --set replicaCount=1 \
  --set etl.Name=logetl-prod-bd-xcxsc-cronjob \
  --set etl.Kafka.Topic=prod-bd-xcxsc-cronjob \
  --set etl.Kafka.ConsumerGroup=prod-bd-xcxsc \
  --set etl.ElasticSearch.Index=prod-bd-xcxsc-cronjob-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/aws-xcxsc-app.conf"


helm install logetl-prod-bd-xcxsc-ingngx . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set image.repository="docker-hub.supor.com/infra/logstash" \
  --set image.tag="7.17.3-geoip" \
  --set etl.Name=logetl-prod-bd-xcxsc-ingngx \
  --set etl.Kafka.Topic=prod-bd-xcxsc-ingngx \
  --set etl.Kafka.ConsumerGroup=prod-bd-xcxsc \
  --set-file etl.StreamFilter="./etl/filters/ingngx-geocity.conf" \
  --set etl.StreamOutput.debugconsole.enabled=false \
  --set etl.StreamOutput.elasticsearch.enabled=true \
  --set etl.StreamOutput.elasticsearch.Index=logstash-prod-bd-xcxsc-ingngx-%{+MMyyyy}

## 更新 ingress-nginx filter
helm upgrade logetl-prod-bd-xcxsc-ingngx . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set image.repository="docker-hub.supor.com/infra/logstash" \
  --set image.tag="7.17.3-geoip" \
  --set etl.Name=logetl-prod-bd-xcxsc-ingngx \
  --set etl.Kafka.Topic=prod-bd-xcxsc-ingngx \
  --set etl.Kafka.ConsumerGroup=prod-bd-xcxsc \
  --set-file etl.StreamFilter="./etl/filters/ingngx-geocity.conf" \
  --set etl.StreamOutput.debugconsole.enabled=false \
  --set etl.StreamOutput.elasticsearch.enabled=true \
  --set etl.StreamOutput.elasticsearch.Index=logstash-prod-bd-xcxsc-ingngx-%{+MMyyyy}



## ------------------------------- dynamic CRM --------------------------------------
helm install logetl-prod-crm-portal-cw . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set etl.Name=logetl-prod-crm-portal-cw \
  --set etl.Kafka.Topic=prod-crm-portal-cw \
  --set etl.Kafka.ConsumerGroup=prod-crm-portal \
  --set etl.ElasticSearch.Index=prod-crm-portal-cw-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/crm-app.conf"

helm install logetl-prod-crm-portal-lka . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set etl.Name=logetl-prod-crm-portal-lka \
  --set etl.Kafka.Topic=prod-crm-portal-lka \
  --set etl.Kafka.ConsumerGroup=prod-crm-portal \
  --set etl.ElasticSearch.Index=prod-crm-portal-lka-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/crm-app.conf"

helm install logetl-prod-crm-portal-sda . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set etl.Name=logetl-prod-crm-portal-sda \
  --set etl.Kafka.Topic=prod-crm-portal-sda \
  --set etl.Kafka.ConsumerGroup=prod-crm-portal \
  --set etl.ElasticSearch.Index=prod-crm-portal-sda-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/crm-app.conf"

helm install logetl-prod-crm-dynamiccrm-cw . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set etl.Name=logetl-prod-crm-dynamiccrm-cw \
  --set etl.Kafka.Topic=prod-crm-dynamiccrm-cw \
  --set etl.Kafka.ConsumerGroup=prod-crm-dynamiccrm \
  --set etl.ElasticSearch.Index=prod-crm-dynamiccrm-cw-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/crm-app.conf"

helm install logetl-prod-crm-dynamiccrm-sda . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set etl.Name=logetl-prod-crm-dynamiccrm-sda \
  --set etl.Kafka.Topic=prod-crm-dynamiccrm-sda \
  --set etl.Kafka.ConsumerGroup=prod-crm-dynamiccrm \
  --set etl.ElasticSearch.Index=prod-crm-dynamiccrm-sda-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/crm-app.conf"

helm install logetl-prod-crm-dynamiccrm-lka . --namespace infra --create-namespace \
  --set replicaCount=3 \
  --set etl.Name=logetl-prod-crm-dynamiccrm-lka \
  --set etl.Kafka.Topic=prod-crm-dynamiccrm-lka \
  --set etl.Kafka.ConsumerGroup=prod-crm-dynamiccrm \
  --set etl.ElasticSearch.Index=prod-crm-dynamiccrm-lka-%{+MMyyyy} \
  --set-file etl.StreamFilter="./etl/filters/crm-app.conf"




## --------------- 检查 logstash etl input,filter,output  ---------------------------
/usr/share/logstash/pipeline/stream-input.conf
/usr/share/logstash/pipeline/stream-filter.conf
/usr/share/logstash/pipeline/stream-output.conf
